# 📦 Map Analyzer - Windowsインストーラー作成手順 (日本語ガイド)

## 🎯 概要

このガイドでは、Map AnalyzerのWindows向けインストーラーを**Inno Setup**を使って作成する方法を、日本語でわかりやすく説明します。

---

## 📋 必要なもの

### ソフトウェア

1. **Windows PC** (Windows 10 以上)
2. **Flutter SDK 3.35.4以上**
   - インストール済みであることを確認: `flutter --version`
3. **Visual Studio 2022**
   - C++ desktop development workload必須
4. **Inno Setup 6.x** (無料)
   - ダウンロード: https://jrsoftware.org/isdl.php
   - 日本語対応版を選択

### 所要時間
- **初回**: 約15-20分
- **2回目以降**: 約5-10分

---

## 🚀 手順1: Flutterアプリをビルド (5-10分)

### 1-1. プロジェクトをダウンロード

```powershell
# PowerShellを管理者権限で開く
cd C:\

# GitHubからクローン
git clone https://github.com/geomatsuyama/Maptag.git
cd Maptag
```

### 1-2. 依存関係をインストール

```powershell
# Flutter依存関係をインストール
flutter pub get
```

**出力例:**
```
Resolving dependencies... (1.2s)
Got dependencies!
```

### 1-3. Windowsリリースビルドを作成

```powershell
# リリースビルド実行 (5-10分かかります)
flutter build windows --release
```

**完了確認:**
```powershell
# 実行ファイルが作成されたか確認
dir build\windows\x64\runner\Release\map_analyzer.exe
```

**成功すると以下が表示されます:**
```
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        2025/12/08     18:30       15728640 map_analyzer.exe
```

---

## 🛠️ 手順2: Inno Setupをインストール (初回のみ)

### 2-1. Inno Setupをダウンロード

1. ブラウザで https://jrsoftware.org/isdl.php にアクセス
2. **"Download Inno Setup 6.x.x"** をクリック
3. インストーラー (`innosetup-6.x.x.exe`) をダウンロード

### 2-2. Inno Setupをインストール

1. ダウンロードした `innosetup-6.x.x.exe` を実行
2. インストールウィザードに従う
3. **言語選択**: 日本語を選択
4. **インストール先**: デフォルト (`C:\Program Files (x86)\Inno Setup 6\`) のままでOK
5. **コンポーネント**: すべてチェック
6. インストール完了

**確認:**
```powershell
# Inno Setupがインストールされたか確認
dir "C:\Program Files (x86)\Inno Setup 6\ISCC.exe"
```

---

## 🎨 手順3: インストーラーをビルド (1-2分)

### 方法A: GUI経由 (初心者推奨 ⭐)

#### ステップ1: Inno Setup Compilerを起動

1. スタートメニュー → Inno Setup → **Inno Setup Compiler** を起動

#### ステップ2: スクリプトを開く

1. メニューバー → **File** → **Open**
2. ファイルを選択: `C:\Maptag\installer\windows_installer.iss`
3. スクリプトが表示される

#### ステップ3: ビルドを実行

1. メニューバー → **Build** → **Compile** (またはF9キー)
2. ビルドログが表示される
3. 「Successful compile」と表示されたら成功! 🎉

**所要時間:** 約1-2分

#### ステップ4: 出力を確認

**インストーラーの場所:**
```
C:\Maptag\installer\output\MapAnalyzer_Setup_v1.0.0_x64.exe
```

**ファイルサイズ:** 約25-30MB

---

### 方法B: コマンドライン経由 (自動化向け)

```powershell
# PowerShellで実行
cd C:\Maptag

# Inno Setup Compilerでビルド
& "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" "installer\windows_installer.iss"
```

**成功メッセージ:**
```
Successful compile (1分23秒)
```

---

## 🧪 手順4: インストーラーをテスト (3-5分)

### 4-1. テスト環境の準備

**推奨:**
- クリーンなWindows環境 (仮想マシン推奨)
- Visual C++ Redistributable が**未インストール**の状態

### 4-2. インストーラーを実行

```powershell
# インストーラーを実行
C:\Maptag\installer\output\MapAnalyzer_Setup_v1.0.0_x64.exe
```

### 4-3. インストールウィザードに従う

#### 画面1: 言語選択
- **日本語** または **English** を選択
- 「OK」をクリック

#### 画面2: セットアップウィザード
- 「次へ」をクリック

#### 画面3: ライセンス同意
- ライセンス条項を読む
- 「同意する」をチェック
- 「次へ」をクリック

#### 画面4: インストール先選択
- デフォルト: `C:\Program Files\Map Analyzer\`
- 変更可能 (必要に応じて)
- 「次へ」をクリック

#### 画面5: タスク選択
- ✅ **デスクトップにアイコンを作成する**
- ✅ **クイック起動にアイコンを追加する** (オプション)
- 「次へ」をクリック

#### 画面6: インストール準備完了
- 設定内容を確認
- 「インストール」をクリック

#### 画面7: インストール中
- プログレスバーが表示される (約30秒)
- Visual C++ Redistributableチェックが実行される

#### 画面8: インストール完了
- ✅ **Map Analyzerを実行する** をチェック
- 「完了」をクリック

### 4-4. アプリ起動確認

1. Map Analyzerが自動起動する
2. ホーム画面が表示される
3. 設定画面 (右上の歯車アイコン) を開く
4. APIキー入力欄が表示されるか確認

**✅ 成功!** アプリが正常に起動しました!

### 4-5. アンインストールテスト (オプション)

1. **コントロールパネル** → **プログラムと機能**
2. **Map Analyzer** を選択
3. 「アンインストール」をクリック
4. 確認ダイアログで「はい」を選択
5. アンインストール完了

**確認:**
- `C:\Program Files\Map Analyzer\` が削除されているか
- スタートメニューからアイコンが消えているか
- デスクトップアイコンが削除されているか

---

## 📤 手順5: インストーラーを配布

### 5-1. GitHub Releasesにアップロード (推奨)

```powershell
# GitHub CLIを使用 (gh.exe がインストールされている場合)
cd C:\Maptag

gh release create v1.0.0 installer\output\MapAnalyzer_Setup_v1.0.0_x64.exe ^
  --title "Map Analyzer v1.0.0 - Windows Installer" ^
  --notes "## 📦 ダウンロード%0A%0AWindows用インストーラーをダウンロードして実行してください。%0A%0A### システム要件%0A- Windows 10 (1809以上) または Windows 11%0A- 64-bit (x64)%0A- RAM: 8GB以上推奨%0A- ディスク: 500MB以上%0A%0A### インストール方法%0A1. MapAnalyzer_Setup_v1.0.0_x64.exe をダウンロード%0A2. インストーラーを実行 (管理者権限)%0A3. セットアップウィザードに従う%0A4. スタートメニューから起動"
```

### 5-2. 直接配布

**Google Drive / OneDrive / Dropbox等:**

1. `MapAnalyzer_Setup_v1.0.0_x64.exe` をアップロード
2. 共有リンクを取得
3. ユーザーに配布

**自社サーバー:**

1. FTP/SFTP でアップロード
2. ダウンロードページを作成
3. インストール手順を記載

---

## 🔧 トラブルシューティング

### ❌ エラー: "Source file does not exist"

**原因:** Flutterビルドが完了していない

**解決策:**
```powershell
# ビルドをクリーンアップして再実行
cd C:\Maptag
flutter clean
flutter pub get
flutter build windows --release
```

### ❌ エラー: "Cannot open LICENSE.txt"

**原因:** LICENSE.txtファイルが存在しない

**解決策:**
```powershell
# LICENSE.txtが存在するか確認
dir C:\Maptag\LICENSE.txt

# 存在しない場合は、Inno Setupスクリプトを編集
# installer\windows_installer.iss を開く
# 以下の行をコメントアウト:
; LicenseFile=..\LICENSE.txt
```

### ❌ エラー: "Japanese.isl not found"

**原因:** Inno Setup日本語言語ファイルが未インストール

**解決策1:** Inno Setupを日本語対応版で再インストール

**解決策2:** スクリプトから日本語言語を削除
```ini
; installer\windows_installer.iss を編集
[Languages]
; Name: "japanese"; MessagesFile: "compiler:Languages\Japanese.isl"  ← コメントアウト
Name: "english"; MessagesFile: "compiler:Default.isl"
```

### ❌ インストール後にアプリが起動しない

**原因:** Visual C++ Redistributableが未インストール

**解決策:**
1. 以下をダウンロード:
   https://aka.ms/vs/17/release/vc_redist.x64.exe
2. `vc_redist.x64.exe` を実行
3. インストール完了後、Map Analyzerを再起動

---

## 📊 ビルド時間とサイズ

| 工程 | 所要時間 | 出力サイズ |
|------|---------|-----------|
| Flutter Windowsビルド | 5-10分 | 60MB (圧縮前) |
| Inno Setupコンパイル | 1-2分 | 25-30MB (圧縮後) |
| インストール | 30秒-1分 | 70MB (インストール後) |
| **合計** | **約10-15分** | **25-30MB (配布用)** |

---

## ✅ 完了チェックリスト

### ビルド前
- [ ] Flutter SDK 3.35.4以上がインストール済み
- [ ] Visual Studio 2022 (C++開発)がインストール済み
- [ ] Inno Setup 6がインストール済み
- [ ] GitHubからプロジェクトをクローン済み

### ビルド中
- [ ] `flutter pub get` 実行完了
- [ ] `flutter build windows --release` 成功
- [ ] `map_analyzer.exe` が作成された
- [ ] Inno Setupでコンパイル成功

### テスト
- [ ] インストーラーを実行できる
- [ ] セットアップウィザードが正常に動作
- [ ] アプリが起動する
- [ ] 設定画面が表示される
- [ ] アンインストールが正常に動作

### 配布
- [ ] インストーラーファイルサイズが25-35MB
- [ ] ファイル名にバージョン番号が含まれている
- [ ] GitHub Releasesまたはクラウドストレージにアップロード
- [ ] ダウンロードリンクをユーザーに共有

---

## 🎓 追加情報

### より詳しいガイド

- **完全版**: `installer/BUILD_INSTALLER.md` - 自動化、CI/CD統合、デジタル署名
- **FAQ**: `installer/INSTALLER_FAQ.md` - よくある質問28選
- **推奨スペック**: `推奨スペック.md` - システム要件とパフォーマンス

### 自動化

GitHub Actionsで自動ビルドを設定することもできます。詳細は `BUILD_INSTALLER.md` の「自動化 (CI/CD)」セクションを参照してください。

---

## 🎉 おめでとうございます!

Map Analyzer の Windowsインストーラーが完成しました!

**作成したインストーラー:**
```
C:\Maptag\installer\output\MapAnalyzer_Setup_v1.0.0_x64.exe
```

このファイルを配布すれば、ユーザーは簡単にMap Analyzerをインストールできます!

---

**Map Analyzer v1.0.0**
© 2025 MapAnalyzer Project

何か問題が発生した場合は、GitHub Issues でお問い合わせください:
https://github.com/geomatsuyama/Maptag/issues
