# 🎉 新機能ガイド / New Features Guide

## 📋 目次 / Table of Contents

1. [自分の画像をアップロードして分析](#1-自分の画像をアップロードして分析)
2. [自動アップデート通知システム](#2-自動アップデート通知システム)
3. [アップデートの反映方法](#3-アップデートの反映方法)

---

## 1. 自分の画像をアップロードして分析

### 📸 概要

スマートフォンやPCから自分で撮影した画像をアップロードして、Gemini AIで分析できる新機能です。

### ✨ 主な機能

- **複数画像の一括アップロード**: スマホ/PCから複数の画像を選択してアップロード
- **バッチAI分析**: 選択した全ての画像をGemini AIで一括分析
- **カスタムプロンプト**: 分析内容を自由にカスタマイズ可能
- **画像プレビュー**: アップロードした画像の詳細表示
- **分析結果の保存**: 各画像ごとに分析結果を保存

### 🎯 使い方

#### Step 1: 画面を開く

1. アプリのホーム画面を開く
2. **「自分の画像を分析」** カードをタップ
3. 画像アップロード画面が表示されます

#### Step 2: 画像をアップロード

1. **「画像を選択」** ボタンをクリック
2. デバイスのファイル選択ダイアログが開きます
3. 分析したい画像を選択(複数選択可能)
4. 選択した画像がグリッド表示されます

#### Step 3: 分析プロンプトを編集(オプション)

デフォルトのプロンプト:
```
この画像に写っている建物、道路、看板、風景などを詳しく説明してください。
```

必要に応じて以下のようにカスタマイズできます:
- **テキスト抽出**: 「この画像の看板や文字を全て抽出してください」
- **物体検出**: 「この画像に写っている車と人を数えてください」
- **詳細説明**: 「この建物の特徴と周辺環境を詳しく説明してください」

#### Step 4: 分析を実行

1. **「画像を分析」** ボタンをクリック
2. 分析が開始され、進捗バーが表示されます
3. 各画像の分析が完了すると、カードのステータスが更新されます:
   - 🟡 **未分析**: まだ分析されていない
   - 🔵 **分析中**: 現在分析中
   - 🟢 **完了**: 分析完了
   - 🔴 **失敗**: エラーが発生

#### Step 5: 結果を確認

1. 画像カードをタップして詳細画面を開く
2. 画像のプレビューと分析結果が表示されます
3. 分析結果はテキスト選択可能(コピー可能)

### 💡 使用例

#### 例1: 街の看板テキスト抽出

**プロンプト**:
```
この画像に写っている看板や標識のテキストを全て抽出してください。
日本語、英語、数字など、全ての文字を正確に記録してください。
```

#### 例2: 建物の特徴分析

**プロンプト**:
```
この建物の以下の特徴を分析してください:
1. 建築様式と外観
2. 建物の高さと階数
3. 外壁の材質と色
4. 周辺環境との調和
```

#### 例3: 道路状況の分析

**プロンプト**:
```
この道路の状況を以下の観点で分析してください:
- 道路の種類(一般道、高速道路など)
- 車線数
- 路面状態
- 周辺の交通インフラ
- 安全性の評価
```

### ⚠️ 注意事項

1. **Gemini APIキーが必要**: 設定画面でAPIキーを設定してください
2. **画像サイズ**: 大きい画像はアップロードに時間がかかります
3. **API制限**: Gemini APIの無料枠には制限があります
4. **インターネット接続**: 分析にはインターネット接続が必要です

---

## 2. 自動アップデート通知システム

### 🔔 概要

GitHub Releasesから最新版を自動チェックし、新しいバージョンがある場合に通知する機能です。

### ✨ 主な機能

- **自動チェック**: アプリ起動時に自動でアップデートを確認
- **スマートキャッシング**: 1日1回のみチェック(過度なAPI呼び出しを防止)
- **バージョン比較**: 現在のバージョンと最新版を自動比較
- **リリースノート表示**: 新バージョンの変更内容を表示
- **ダウンロードリンク**: ワンクリックでGitHub Releasesページへ
- **更新を後で**: 通知を閉じても、次回起動時に再表示
- **更新を無視**: 特定のバージョンの通知を無効化

### 🎯 自動チェックの動作

1. **アプリ起動時**: ホーム画面が表示されてから数秒後に自動チェック
2. **チェック間隔**: 24時間に1回(前回チェックから24時間経過後)
3. **新バージョン検出**: 最新版が見つかった場合、ダイアログを表示
4. **最新版の場合**: 通知は表示されません

### 🎯 手動チェックの方法

#### Step 1: 設定画面を開く

1. ホーム画面右上の **⚙️ 設定** アイコンをタップ
2. 設定画面が表示されます

#### Step 2: アップデートを確認

1. **「アプリバージョン」** セクションを探す
2. 現在のバージョンが表示されています (例: Version 1.0.0)
3. **「アップデートを確認」** ボタンをタップ

#### Step 3: 結果を確認

**ケース1: 新しいバージョンがある場合**

ダイアログに以下の情報が表示されます:
- **現在のバージョン**: 例: v1.0.0
- **最新バージョン**: 例: v1.1.0
- **リリース日**: 公開日
- **リリースノート**: 変更内容
- **Web版の更新方法**: ブラウザキャッシュのクリア手順

**ケース2: 最新版の場合**

「✅ 最新版です」というメッセージが表示されます。

### 📥 アップデートダイアログの操作

<img src="https://via.placeholder.com/600x400/4CAF50/FFFFFF?text=Update+Available" alt="Update Dialog" width="300">

1. **「後で」ボタン**: 
   - ダイアログを閉じます
   - 次回アプリ起動時に再表示されます
   - このバージョンの通知は記録されます

2. **「ダウンロードページへ」ボタン**:
   - GitHub Releasesページが新しいタブで開きます
   - インストーラーやアップデート手順が確認できます

### 🔄 アップデート通知のリセット

以前に「後で」を選択した通知を再表示したい場合:

1. ブラウザの開発者ツールを開く(F12)
2. **Console** タブを選択
3. 以下のコマンドを実行:

```javascript
// 無視された更新をリセット
localStorage.removeItem('dismissed_update_version');

// 最終チェック時刻をリセット
localStorage.removeItem('last_update_check');

// ページをリロード
location.reload();
```

---

## 3. アップデートの反映方法

### 🌐 Web版の更新手順

#### 方法1: ブラウザキャッシュをクリア(推奨)

**Chrome / Edge**:
```
1. Ctrl+Shift+Delete (Windows) または Cmd+Shift+Delete (Mac)
2. 「キャッシュされた画像とファイル」を選択
3. 「データを削除」をクリック
4. ページをリロード: Ctrl+F5 または Cmd+Shift+R
```

**Firefox**:
```
1. Ctrl+Shift+Delete (Windows) または Cmd+Shift+Delete (Mac)
2. 「キャッシュ」を選択
3. 「今すぐ消去」をクリック
4. ページをリロード: Ctrl+F5 または Cmd+Shift+R
```

**Safari**:
```
1. Safari > 環境設定 > 詳細
2. 「メニューバーに"開発"メニューを表示」をチェック
3. 開発 > キャッシュを空にする
4. ページをリロード: Cmd+R
```

#### 方法2: スーパーリロード

ブラウザのキャッシュを無視して最新版を取得:

- **Windows**: `Ctrl + F5` または `Ctrl + Shift + R`
- **Mac**: `Cmd + Shift + R`
- **Linux**: `Ctrl + F5` または `Ctrl + Shift + R`

#### 方法3: シークレットモード/プライベートウィンドウ

キャッシュを使わずに最新版を確認:

- **Chrome**: `Ctrl+Shift+N` (Windows) / `Cmd+Shift+N` (Mac)
- **Firefox**: `Ctrl+Shift+P` (Windows) / `Cmd+Shift+P` (Mac)
- **Safari**: `Cmd+Shift+N` (Mac)

### 💻 デスクトップ版の更新手順

#### Windows

1. GitHub Releasesページを開く
2. 最新版の **`MapAnalyzer_Setup_vX.X.X_x64.exe`** をダウンロード
3. ダウンロードしたインストーラーを実行
4. 既存のバージョンは自動的にアップデート

#### macOS

1. GitHub Releasesページを開く
2. 最新版の **`MapAnalyzer_vX.X.X_macOS.dmg`** をダウンロード
3. DMGファイルを開く
4. アプリを「アプリケーション」フォルダにドラッグ(上書き)

#### Linux

**AppImage**:
```bash
# 最新版をダウンロード
wget https://github.com/geomatsuyama/Maptag/releases/download/vX.X.X/MapAnalyzer-X.X.X-x86_64.AppImage

# 実行権限を付与
chmod +x MapAnalyzer-X.X.X-x86_64.AppImage

# 実行
./MapAnalyzer-X.X.X-x86_64.AppImage
```

**Debian/Ubuntu (.deb)**:
```bash
# ダウンロード
wget https://github.com/geomatsuyama/Maptag/releases/download/vX.X.X/map-analyzer_X.X.X_amd64.deb

# インストール
sudo dpkg -i map-analyzer_X.X.X_amd64.deb
```

**Snap Package**:
```bash
# インストール(開発中)
# sudo snap install map-analyzer
```

### 🔍 アップデート確認コマンド

アプリのバージョンを確認:

**Web版**:
```javascript
// ブラウザの開発者ツール(F12) > Console
console.log('Version: 1.0.0'); // 現在のバージョン
```

**デスクトップ版**:
```bash
# アプリの「設定」画面で確認
# または、ターミナルで
./MapAnalyzer --version
```

---

## 📊 更新履歴 / Update History

### Version 1.0.0 (2024-12-09)

**新機能**:
- ✅ 自分の画像をアップロードしてAI分析
- ✅ 自動アップデート通知システム
- ✅ Mapillary API接続テスト機能
- ✅ 詳細なエラーメッセージとデバッグログ

**改善**:
- 🔧 GeminiServiceでBase64画像をサポート
- 🔧 設定画面にバージョン情報を追加
- 🔧 ホーム画面のUI改善

**修正**:
- 🐛 API接続エラーのハンドリング改善
- 🐛 画像分析のエラーメッセージを明確化

---

## 💡 よくある質問 / FAQ

### Q1: アップデート通知が表示されません

**A**: 以下を確認してください:
1. インターネット接続が正常か確認
2. 設定画面から手動で「アップデートを確認」を実行
3. 前回チェックから24時間経過しているか確認
4. ブラウザのコンソールでエラーがないか確認

### Q2: 画像アップロードが失敗します

**A**: 以下を確認してください:
1. Gemini APIキーが設定されているか確認
2. インターネット接続が正常か確認
3. 画像ファイルのサイズが大きすぎないか確認(推奨: 5MB以下)
4. ブラウザがファイル選択をブロックしていないか確認

### Q3: Web版で最新版が表示されません

**A**: 以下の手順を試してください:
1. ブラウザのキャッシュをクリア
2. スーパーリロード(Ctrl+F5 / Cmd+Shift+R)
3. シークレットモードで開く
4. それでも解決しない場合は、GitHub Releasesから直接ダウンロード

### Q4: デスクトップ版のアップデート方法は?

**A**: プラットフォームごとに異なります:
- **Windows**: 最新のインストーラーを実行(既存版を自動更新)
- **macOS**: 最新のDMGをダウンロードして上書き
- **Linux**: 最新のAppImage/DEBをダウンロードしてインストール

---

## 🔗 リンク / Links

- **GitHubリポジトリ**: https://github.com/geomatsuyama/Maptag
- **Releases**: https://github.com/geomatsuyama/Maptag/releases
- **Web版デモ**: https://5060-i6w1gve4ssf8ly2hkqauq-02b9cc79.sandbox.novita.ai
- **Issue報告**: https://github.com/geomatsuyama/Maptag/issues

---

## 📞 サポート / Support

質問や問題がある場合:
1. GitHub Issuesで報告
2. 開発者ツール(F12)のコンソールログをスクリーンショット
3. 発生した問題の詳細を記載

---

**Last Updated**: 2024-12-09  
**Version**: 1.0.0  
**Author**: Map Analyzer Team
